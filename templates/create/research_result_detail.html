<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap 的 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
          integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <title>科研成果详情</title>
</head>
<body>
{% include 'navbar.html' %}
<div class="container mt-5">
    <div class="card" style="border: 5px solid #d2e2f1;">
        <div class="card-body d-flex justify-content-between align-items-center">
            <h3 class="card-title">{{ research_result.Title }}</h3>
            <button id="citeButton" data-id="{{ research_result.AchievementID }}" class="btn btn-outline-primary ml-3">引用</button>
        </div>
        <div class="card-body">
            <p class="card-text">作者：{{ research_result.Author }}</p>
            <p class="card-text">所有权归属：{{ research_result.Ownership }}</p>
            <p class="card-text">价格：{{ research_result.Price }}</p>
            <p class="card-text">摘要：{{ research_result.Abstract }}</p>
            <p class="card-text">关键词：
                {% for keyword in keywords %}
                    <span class="badge {% cycle 'badge-primary' 'badge-secondary' 'badge-success' 'badge-danger' 'badge-warning' 'badge-info' 'badge-light' 'badge-dark' %}">{{ keyword }}</span>
                {% endfor %}
            </p>
            <p class="card-text">成果类型：<span class="badge badge-info">{{ research_result.get_AchievementType_display }}</span></p>
            <p class="card-text">成果状态：<span class="badge badge-success">{{ research_result.get_ResearchStatus_display }}</span></p>
            <p class="card-text">上传时间：{{ research_result.UploadTime }}</p>
            <p class="card-text">被查看次数：{{ research_result.ReadingCount }}</p>
            <p class="card-text">被引用次数：{{ research_result.CitingCount }}</p>
            <!-- 科研成果附件文件夹 -->
            <h2>附件：</h2>
            {% for file in research_result.files.all %}
                <p><a href="{% url 'download_file' file_id=file.id %}">{{ file.filename }}</a></p>
            {% endfor %}
        </div>
    </div>
</div>

<br>
<script>
document.getElementById('citeButton').addEventListener('click', function() {
    var researchResultId = this.getAttribute('data-id');
    // Get CSRF token from cookies
    var csrftoken = document.cookie.split('; ').find(row => row.startsWith('csrftoken')).split('=')[1];
    // Send request to backend, increase citing count and get content to copy
    fetch(`/create/increase_citing_count/${researchResultId}`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken
        }
    })
    .then(response => response.json())
    .then(data => {
        var researchResultInfo = data.content_to_copy;
        navigator.clipboard.writeText(researchResultInfo).then(function() {
            alert('科研成果引用信息已复制到剪贴板！');
        }, function(err) {
            alert('Could not copy text: ' + err);
        });
    });
});

</script>
</body>
</html>